---
title: "Untitled"
output: pdf_document
date: "2023-11-29"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

1.  

```{r}
library(rvest)
library(dplyr)
library(polite)

url <- "https://www.imdb.com/chart/toptv/?ref_=nv_tvv_250"

session <- bow(url,user_agent = "Educational Purposes")
session

```

1.  

```{r}
library(rvest)
title <- scrape(session)%>%
html_nodes("h3.ipc-title__text")%>%
html_text
title

subsettt <- as.data.frame(title[2:51])
colnames(subsettt) <- "title"
split_df <- strsplit(as.character(subsettt$ranks), ".", fixed = TRUE )
split_df<- data.frame(do.call(rbind, subsettt))
subsettt




  

```
1.
```{r}

votec <- scrape(session) %>%
  html_nodes("span.ipc-rating-star--voteCount") %>%
  html_text
subvote <- as.data.frame(votec[1:50])
colnames(subvote) <- "votecount"
split_df2 <- strsplit(as.character(subvote$voteCount), ".", fixed = TRUE )
split_df2 <- data.frame(do.call(rbind, subrate))
subvote

```


1.  

```{r}
library(rvest)
library(stringr)
rate <- scrape(session) %>%
  html_nodes("span.ipc-rating-star--imdb")  %>%
html_attr("aria-label")
rate

rate_sub<- as.data.frame(rate[2:51])
head(rate_sub)
colnames(rate_sub) <- "rate"
split_df <- strsplit(as.character(rate_sub$rate),".",fixed = TRUE)
split_df <- data.frame(do.call(rbind,split_df))


head(rate_sub)




```

1.  extract ratings

```{r}
ratesubs<- str_extract(rate_sub$rate, "\\d+\\.\\d+")
ratesubs

```
1.Temporary data frame
```{r}
wedata <- data.frame(
  Title = subsettt,
  Rate = ratesubs,
  Vote_count = voteCount
)
wedata
```
1. number of episodes
```{r}
year <- scrape(session)%>%
  html_nodes("span.sc-479faa3c-8.bNrEFi.cli-title-metadata-item") %>%
  html_text
year


  

```


FINAL CHANGES

4. Select 3 products from Amazon of the same category. Extract the price, description, ratings and reviews of each product.

```{r} # Install and load required packages library(rvest) library(dplyr) library(httr) library(xml2) library(purrr) library(stringr) product1 <- read_html("https://www.amazon.com/dp/B07KRY43KN/ref=s9_acsd_al_bw_c2_x_2_i?pf_rd_m=ATVPDKIKX0DER&pf_rd_s=merchandised-search-4&pf_rd_r=GZGJJ856P8VPY486DVX2&pf_rd_t=101&pf_rd_p=b48f1b52-3d78-40aa-8e5b-0e5b1e8f2dba&pf_rd_i=21217035011") product2 <- read_html("https://www.amazon.com/dp/B01EZV35QU/ref=s9_acsd_al_bw_c2_x_9_i?pf_rd_m=ATVPDKIKX0DER&pf_rd_s=merchandised-search-4&pf_rd_r=GZGJJ856P8VPY486DVX2&pf_rd_t=101&pf_rd_p=b48f1b52-3d78-40aa-8e5b-0e5b1e8f2dba&pf_rd_i=21217035011") product3 <- read_html("https://www.amazon.com/dp/B099WTN2TR/ref=s9_acsd_al_bw_c2_x_6_i?pf_rd_m=ATVPDKIKX0DER&pf_rd_s=merchandised-search-4&pf_rd_r=GZGJJ856P8VPY486DVX2&pf_rd_t=101&pf_rd_p=b48f1b52-3d78-40aa-8e5b-0e5b1e8f2dba&pf_rd_i=21217035011") 
``` 

#---------------------------------------------------- PRICE #___________________________________________________ 
PRICE 1,2 and 3

```{r} 
product1 <- read_html("https://www.amazon.com/dp/B07KRY43KN/ref=s9_acsd_al_bw_c2_x_2_i?pf_rd_m=ATVPDKIKX0DER&pf_rd_s=merchandised-search-4&pf_rd_r=GZGJJ856P8VPY486DVX2&pf_rd_t=101&pf_rd_p=b48f1b52-3d78-40aa-8e5b-0e5b1e8f2dba&pf_rd_i=21217035011")

product2 <- read_html("https://www.amazon.com/dp/B01EZV35QU/ref=s9_acsd_al_bw_c2_x_9_i?pf_rd_m=ATVPDKIKX0DER&pf_rd_s=merchandised-search-4&pf_rd_r=GZGJJ856P8VPY486DVX2&pf_rd_t=101&pf_rd_p=b48f1b52-3d78-40aa-8e5b-0e5b1e8f2dba&pf_rd_i=21217035011") 

product3 <- read_html("https://www.amazon.com/dp/B099WTN2TR/ref=s9_acsd_al_bw_c2_x_6_i?pf_rd_m=ATVPDKIKX0DER&pf_rd_s=merchandised-search-4&pf_rd_r=GZGJJ856P8VPY486DVX2&pf_rd_t=101&pf_rd_p=b48f1b52-3d78-40aa-8e5b-0e5b1e8f2dba&pf_rd_i=21217035011")

# Extract the price for each product

price1 <- product1 %>% html_nodes("span.a-offscreen") %>% html_text() %>% .[1] 
price2 <- product2 %>% html_nodes("span.a-offscreen") %>% html_text() %>% .[1] 
price3 <- product3 %>% html_nodes("span.a-offscreen") %>% html_text() %>% .[1] 

# Create a data frame with prices

Price <- data.frame(Price = c(price1, price2, price3))
``` 

#---------------------------------------------------- DESCRIPTION #___________________________________________________ 
#-------------------------------------------------------- DESCRIPTION 


```{r} 
#number1
des <- product1 %>% html_nodes("span.a-list-item") %>% html_text() descrange <- paste(des[33:37], collapse = " ") 
```

```{r} 
des <- product2%>% html_nodes("span.a-list-item") %>% html_text() descrange2 <- paste(des[63:67], collapse = " ")
``` 

```{r} 
des <- product3%>% html_nodes("span.a-list-item") %>% html_text() descrange3 <- paste(des[58:62], collapse = " ") 
```
DATA FRAME FOR DESCRIPTION 
```{r} result_df <- data.frame(Description = c(descrange, descrange2, descrange3)) 
```

#------------------------------------------------
#---------------------------------------------------- RATINGS #___________________________________________________ 
RATINGS #1 

```{r}
library(rvest) #number 1 

product1 <- read_html("https://www.amazon.com/dp/B07KRY43KN/ref=s9_acsd_al_bw_c2_x_2_i?pf_rd_m=ATVPDKIKX0DER&pf_rd_s=merchandised-search-4&pf_rd_r=GZGJJ856P8VPY486DVX2&pf_rd_t=101&pf_rd_p=b48f1b52-3d78-40aa-8e5b-0e5b1e8f2dba&pf_rd_i=21217035011") 

rate1 <- product1 %>% html_nodes("span.a-size-base#acrCustomerReviewText") %>% html_text() 
numeric_data <- as.numeric(gsub("\\D", "", rate1)) 
data1 <- format(numeric_data, big.mark = ",") 
 print(data1)
``` 


RATINGS #2 
```{r} 
library(rvest) #number 2 

product2 <- read_html("https://www.amazon.com/dp/B01EZV35QU/ref=s9_acsd_al_bw_c2_x_9_i?pf_rd_m=ATVPDKIKX0DER&pf_rd_s=merchandised-search-4&pf_rd_r=GZGJJ856P8VPY486DVX2&pf_rd_t=101&pf_rd_p=b48f1b52-3d78-40aa-8e5b-0e5b1e8f2dba&pf_rd_i=21217035011") 

rate2 <- product2 %>% html_nodes("span.a-size-base#acrCustomerReviewText") %>% html_text() 
numeric_data2 <- as.numeric(gsub("\\D", "", rate2)) # Get only the first element from the first row first_element <- numeric_data2[1] 
data2 <- format(first_element, big.mark = ",") 

print(data2) 
``` 

```{r} 
library(rvest) #number 3

product3 <- read_html("https://www.amazon.com/dp/B099WTN2TR/ref=s9_acsd_al_bw_c2_x_6_i?pf_rd_m=ATVPDKIKX0DER&pf_rd_s=merchandised-search-4&pf_rd_r=GZGJJ856P8VPY486DVX2&pf_rd_t=101&pf_rd_p=b48f1b52-3d78-40aa-8e5b-0e5b1e8f2dba&pf_rd_i=21217035011") 

rate3 <- product3 %>% html_nodes("span.a-size-base#acrCustomerReviewText") %>% html_text() 

numeric_data3 <- as.numeric(gsub("\\D", "", rate3)) # Get only the first element first_element3 <- numeric_data3[1] 
data3 <- format(first_element3, big.mark = ",") 
print(data3)
``` 

DATA FRAME FOR RATINGS
```{r} 
 ratings <- c(data1, data2, data3) 
ratings_data <- data.frame(Ratings = ratings) 
ratings_data 
``` 


#---------------------------------------------------- REVIEWS #___________________________________________________ reviews #1 

```{r}
library(rvest)
library(stringr)
 review_text <- product1 %>% html_node("span.a-size-base.review-text") %>% html_text()

 review_text <- str_replace_all(review_text, "\n", "") 
cat(review_text, sep = " ") 

``` 


review# 2

```{r}
library(rvest)
library(stringr) 

review_text2 <- product2 %>% html_node("span.a-size-base.review-text") %>% html_text() 
review_text2 <- str_replace_all(review_text2, "\n", "") # Print the extracted review text without newline characters cat(review_text, sep = " ") 
``` 
review3 

```{r} 

review_text3 <- product3 %>% html_node("span.a-size-base.review-text") %>% html_text() 
review_text3 <- str_replace_all(review_text3, "\n", "") # Print the extracted review text without newline characters cat(review_text3, sep = " ") 
``` 

DATA FRAME FOR REVIEWS 
```{r} reviews_df <- data.frame( ReviewText = c(review_text, review_text2, review_text3) ) # Print the combined data frame print(reviews_df)
``` 

```{r} 
# ALL COMBINED DATA IN ONE FRAME

if (nrow(Price) == nrow(result_df) && nrow(result_df) == nrow(ratings_data) && nrow(ratings_data) == nrow(reviews_df)) { combined_data <- cbind(Price, result_df, ratings_data, reviews_df)

print(combined_data) } ```
